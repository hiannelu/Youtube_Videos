<!DOCTYPE html>
<html>
<head>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.0.0/video.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.min.js" integrity="sha512-mF+XuiEvJq707N/B9Fm/fI2wgMcWuFLsoztIp0UzEKgHCZgczbYpO2+Vq2TEi0LmE4crVj2r8AYru7X5QjVotw==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-youtube/2.6.1/Youtube.js" integrity="sha512-wKJflLtBLm17q2xfXgyi1zHcd5v61unuxlu5rr8KWo7aCYl/lBT3Tg+gthkVDVIY+NUFwylUW/3w5kmFao18Hg==" crossorigin="anonymous"></script>
  <script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script>
  <link href="https://vjs.zencdn.net/7.8.4/video-js.css" rel="stylesheet" />
<style>
	.wrap-redirect {
		margin: auto;
		width: 50%;
	}
	.video-title {
		font-size: 18px;
	}
	#display-text {
		border: none;
	}
	#myAd {
		position: absolute;
		margin-left: -45px;
		left: 33%;
		top: 40px;
	}
	.button-container {
		display: flex;
		flex-direction: row;
		justify-content: space-between;
		align-items: center;
		width: 560px;
	}
  </style>
</head>
<body>
  <script>
	let url = location.search;
	let videoId = url.substr(1);
  
	$(document).ready(function() {
		
	let vid = 
	  `<video id="play-video" width="560" height="315" class="video-js vjs-default-skin" controls>
		<source
		src= "https://www.youtube.com/embed/${videoId}"
		type="video/youtube">
	  </video>`
	$('#display').html(vid);
	  
	
	
	getDetails();
	function getDetails() {
	  $.get(
	  "https://www.googleapis.com/youtube/v3/videos", {
		part: 'snippet',
		id: videoId,
		key: 'AIzaSyCzAL1xY0dm3aKQIkiYdbpT-QXytuXR3qI'},
		function(data) {
		  $.each(data.items, function(i, item) {

			let videoTitle = item.snippet.title;
			description = item.snippet.description;
			
			let output =
			`<div class="video-title">${videoTitle}</div>
			<textarea id="display-text" rows="4" cols="80">${description}</textarea>
			<br>
			<div class="button-container">
				<button id="save-videos" onclick="saveVids()">SAVE</button>
				<input id="show-button" type="button" value="SHOW MORE" onclick="showMore()">
				<button onclick="home()">HOME</button>
			</div>`

			$('#description').html(output);
			checkButton();
		  })
		}
	)}
	

	let player = videojs('play-video');
	player.play();
	
	player.on('pause', function(event) {
        $('#myAd').show();
	});
	player.on('play', function(event) {
        $('#myAd').hide();
	});
  });
  
  let displayText = 'less';
  let description;
  let status;
  let cookieValue = document.cookie;
 
  let arr = cookieValue.replace(/=/g, '').split(';');
  
  function checkButton() {
		let len = arr.length;

		if (len !== 0) {
			while(len > 0) {
				if (arr[len - 1].replace(/\s/g, '') === videoId) {
					$('#save-videos').html('CANCEL');
					status = 'cancel';
					break;  
				}
				len--;
			}
		}
		if (len === 0) {
			$('#save-videos').html('SAVE');
			status = 'save';
		}
	}

  function showMore() {
	if (displayText === 'less') {
		$('#display-text').attr('rows', 100);
		$('#display-text').html(description);
		$('#show-button').prop('value', 'SHOW LESS');
		displayText = 'more';
	} else {
		$('#display-text').attr('rows', 3);
		$('#show-button').prop('value', 'SHOW MORE');
		displayText = 'less';
	}
  }



  function saveVids() {

	  if (status === 'save') {
		document.cookie = videoId;
		$('#save-videos').html('CANCEL');
		status = 'cancel';
	  } else if (status === 'cancel') {
		document.cookie = videoId+'='+'; expires=Thu, 01 Jan 1970 00:00:00 UTC';
		$('#save-videos').html('SAVE');
		status = 'save';
	  }
  }

  function home() {location.href = "1004-project.html";}

  </script>
  <div class="wrap-redirect">
	<div id="display"></div>
	<div id="description"></div>
	<img id="myAd" src="pic.jpg" width="450" height="260" />
	
  </div>
</body>
</html>